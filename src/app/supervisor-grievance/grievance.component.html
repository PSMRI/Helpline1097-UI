<div class="row" *ngIf="action === 'view'">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <label class="pull-left">
      <h4 class="f-s-b m-b-30">Feedback Tracking</h4>
    </label>
  </div>
  <!-- </div>
<div class="row"> -->
  <form [formGroup]="feedbackForm2" (ngSubmit)="onSearch()">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">
        <md2-datepicker (keydown)="blockey($event)" [max]="maxDate" #startDate [style.width]="'100%'" formControlName="startDate"
          placeholder="Start Date (dd/MM/yyyy)"></md2-datepicker>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">
        <md2-datepicker (keydown)="blockey($event)" [style.width]="'100%'" [min]="startDate.value" [max]="maxDate" formControlName="endDate"
          placeholder="End Date(dd/MM/yyyy)"></md2-datepicker>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">
        <md-input-container style="width: 100%">
          <input mdInput id="ComplaintId" placeholder="Enter Feedback ID" formControlName="feedbackID" maxlength="30">
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-6 col-md-3 col-lg-3">
        <button md-raised-button color="primary" class="m-t-lg-20" type="submit" name="search">Search</button>
      </div>
    </div>
  </form>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" *ngIf="action === 'view'">
    <h4 class="pull-left f-s-b m-b-30">FeedBack Details</h4>
  </div>
  <div class="col-xs-12 col-sm-12" *ngIf="action === 'view'">
    <div class="table-responsive m-t-10">
      <table class="table table-striped" [md2Data]="feedbackList" #md2="md2DataTable" [rowsPerPage]="3">
        <thead>
          <tr>
            <th>Feedback ID</th>
            <th>Feedback Date</th>
            <th>Name Of Beneficiary</th>
            <th>Type Of Feedback</th>
            <th>Feedback Status</th>
            <th>Email Status</th>
            <!-- <th>Select</th> -->
            <th>Edit</th>
            <th>Update Response</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="md2.data.length < 1">
            <td class="t-a-c" colspan="8">
              No Records Found
            </td>
          </tr>
          <tr *ngFor="let feedback of md2.data">
            <td (click)="onClick(feedback)">{{feedback.feedbackID}}</td>
            <td>{{millisToUTCDate(feedback.createdDate) | date:'dd/MM/yyyy HH:mm'}}</td>
            <td>{{feedback.beneficiaryName}}</td>
            <td>{{feedback.feedbackTypeName}}</td>
            <td>{{feedback.feedbackStatusName}}</td>
            <td>{{feedback.emailStatusName}}</td>
            <!-- <td align="center">
                <input type="checkbox" value="" />
              </td> -->
            <td>
              <button md-raised-button color="accent" type="button" (click)="requestFeedback(feedback)">Edit</button>
            </td>
            <td>
              <button md-raised-button color="primary" type="submit" (click)="updateResponse(feedback)" *ngIf="feedback?.feedbackRequests?.length > 0">Update</button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="8">
              <md2-pagination></md2-pagination>
            </td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
<div class="row m-b-40" *ngIf="(action === 'edit') || (action === 'update')">
  <div class="col-md-2 col-lg-2 pull-right">
    <button type="button" md-raised-button color="primary" (click)="back()">back</button>
  </div>
  <form [formGroup]="feedbackForm" (ngSubmit)="onSubmit()">
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Feedback ID" maxlength="10" id="feedbackID" formControlName="feedbackID" readonly>
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Beneficiary Name" id="beneficiaryName" formControlName="beneficiaryName" maxlength="20" readonly>
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Feedback Date" id="Feedback Date" formControlName="feedbackDate" maxlength="10" readonly>
        </md-input-container>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Feedback Type" id="BeneficiaryRegID" formControlName="feedbackTypeName" maxlength="20" readonly>
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Feedback Status" id="FeedbackStatus" formControlName="feedbackStatusName" maxlength="20" readonly>
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Email Status" id="EmailStatus" formControlName="emailStatusName" maxlength="10" readonly>
        </md-input-container>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Institution Name ." id="InstitutionName" formControlName="institutionName" maxlength="20" readonly>
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Designation Name ." id="DesignationName" formControlName="designationName" maxlength="20" readonly>
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Severity Type" id="SeverityTypeName" formControlName="severityTypeName" maxlength="20" readonly>
        </md-input-container>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Service" id="ServiceName" formControlName="serviceName" maxlength="20" readonly>
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="UserName" id="UserName" formControlName="userName" maxlength="50" readonly>
        </md-input-container>
      </div>
      <!-- <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
            <md2-datepicker [max]="maxDate" [style.width]="'100%'" placeholder="Incident Date"
            name="dateIncident" [(ngModel)]="dateIncident"></md2-datepicker>
         <md-input-container style="width: 100%">
            <input mdInput placeholder="Phone Number For SMS" id="SMSPhoneNo" formControlName="smsPhoneNo" maxlength="50" readonly>
          </md-input-container>
        </div> -->
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Created By" id="CreatedBy" formControlName="createdBy" maxlength="10" readonly>
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Modified By" id="ModifiedBy" formControlName="modifiedBy" maxlength="10" readonly>
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container style="width: 100%">
          <input mdInput placeholder="Incident Date" id="incidentDate" formControlName="incidentDate" readonly>
        </md-input-container>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6" *ngIf="action==='edit'">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <md-input-container style="width: 100%">
          <textarea mdInput rows="3"  id="Feedback" placeholder="Feedback"  formControlName="feedbackSupSummary"></textarea>
        </md-input-container>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6" *ngIf="action==='update'">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <md-input-container style="width: 100%">
          <textarea mdInput rows="3"  id="Feedback" placeholder="Feedback"  formControlName="feedbackSupSummary"></textarea>
        </md-input-container>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6" *ngIf="action==='edit'">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <md-input-container style="width: 100%">
          <textarea mdInput rows="3"  id="comments" placeholder="Supervisor Comment"  formControlName="comments"></textarea>
        </md-input-container>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6" *ngIf="action==='update'">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <md-input-container style="width: 100%">
          <textarea mdInput  rows="3"  id="response" placeholder="Response Received"  formControlName="comments"></textarea>
        </md-input-container>
      </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" *ngIf="action==='update'">
      
      <button md-raised-button color="primary" class="pull-right" type="submit" name="save">Save</button>
      <div class="form-group col-lg-2 col-md-6 col-sm-6 col-xs-6 pull-right">
          <label for="upload-file">Upload File(Size limit :{{maxFileSize}}MB)</label>
          <input type="file" accept="*" size="100" placeholder="Upload file" id="upload-file" (change)="onFileUpload($event)" name="file">
        </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container class="hide_underline" [style.width]="'100%'">
          <input mdInput style="display:none">
          <md-select placeholder="Feedback Status" [style.width]="'100%'" formControlName="feedbackStatusID">
            <md-option *ngFor="let feedbackStatus of feedbackStatuses" [value]="feedbackStatus.feedbackStatusID">
              {{feedbackStatus.feedbackStatus}}
            </md-option>
          </md-select>
          <!-- <md-hint>
              <span class="error_text"></span>
            </md-hint> -->
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4">
        <md-input-container class="hide_underline" [style.width]="'100%'">
          <input mdInput style="display:none">
          <md-select placeholder="Email Status" [style.width]="'100%'" formControlName="emailStatusID">
            <md-option *ngFor="let emailStatus of emailStatuses" [value]="emailStatus.emailStatusID">
              {{emailStatus.emailStatus}}
            </md-option>
          </md-select>
          <!-- <md-hint>
              <span class="error_text"></span>
            </md-hint> -->
        </md-input-container>
      </div>
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4" *ngIf="action==='edit'">
        <button md-raised-button color="primary" class="pull-right" type="submit" name="save"> Save/Email</button>
      </div>
    </div>
  </form>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" *ngIf="feedBackRequestsResponse?.length>0">
    <h4>FeedBack Request/Response</h4>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" *ngIf="feedBackRequestsResponse?.length>0 && false">
    <table class="table table-responsive table-striped">
      <thead>
        <tr>
          <th>FeedBack Request ID</th>
          <th>Comments</th>
          <th>Email Status</th>
          <th>Email Status Description</th>
          <th> Updated Date</th>

        </tr>
      </thead>
      <tbody *ngFor="let feedBackRequest of feedBackRequestsResponse | paginate: { itemsPerPage: 5, currentPage: pa } ">
        <tr style="cursor:pointer" (click)="showResponse($event)">
          <td>{{feedBackRequest.feedbackRequestID}}</td>
          <td>{{feedBackRequest.comments}}</td>
          <td>{{feedBackRequest.emailStatus?.emailStatus}}</td>
          <td>{{feedBackRequest.emailStatus?.emailStatusDesc}}</td>
          <td>{{millisToUTCDate(feedBackRequest.createdDate) | date:'dd/MM/yyyy HH:mm'}}</td>
        </tr>
        <tr *ngFor="let feedBackResponse of feedBackResponses" [collapse]="isCollapsedResponse">
          <td>{{feedBackResponse.feedbackRequestID}}</td>
          <td>{{feedBackResponse.comments}}</td>
          <td></td>
          <td></td>
          <td>{{millisToUTCDate(feedBackResponse.createdDate) | date:'dd/MM/yyyy HH:mm'}}</td>
        </tr>
      </tbody>
    </table>
    <pagination-controls (pageChange)="pa = $event"></pagination-controls>
  </div>
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" *ngIf="consolidatedRequests?.length>0">
    <table class="table table-responsive table-striped">
      <thead>
        <tr>
          <th>FeedBack Request ID</th>
          <th>Feedback Description</th>
          <th>Supervisor Comments</th>
          <th>Response Received</th>
          <th>Last Feedback Status</th>
          <th>Email Status</th>
          <th>Forwarded By</th>
          <th>Forwarded Date</th>
          <th>Updated By</th>
          <th>Updated Date</th>
          <th>Attachment</th>
        </tr>
      </thead>
      <tbody *ngFor=" let feedBackRequest of consolidatedRequests ">
        <tr>
          <td>{{feedBackRequest.feedbackRequestID}}</td>
          <td>{{feedBackRequest.feedbackSupSummary}}</td>
          <td>{{feedBackRequest.comments}}</td>
          <td>{{feedBackRequest.responseComments}}</td>
          <td>{{feedbackStatusName}}</td>
          <td>{{feedBackRequest.emailStatus?.emailStatus}}</td>
          <td>{{feedBackRequest.createdBy}}</td>
          <td>{{millisToUTCDate(feedBackRequest.createdDate) | date:'dd/MM/yyyy HH:mm'}}</td>
          <td>{{feedBackRequest.responseUpdatedBy}}</td>
          <td>{{feedBackRequest.responseDate?(millisToUTCDate(feedBackRequest.responseDate) | date:'dd/MM/yyyy HH:mm'):""}}</td>
          <td><a *ngIf="feedBackRequest.attachmentPath" href="{{feedBackRequest.attachmentPath}}" target="_blank"><i class="material-icons">file_download</i></a></td>
        </tr>
      </tbody>
      <tfoot>
      </tfoot>
    </table>
  </div>
</div>